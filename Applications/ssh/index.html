
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jasper-zanjani.github.io/notes/Applications/ssh/">
      
      
        <link rel="prev" href="../selinux/">
      
      
        <link rel="next" href="../syncthing/">
      
      <link rel="icon" href="../../img/brain.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.17">
    
    
      
        <title>SSH - Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../style/tooltip-width.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="yellow">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ssh" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Notes" class="md-header__button md-logo" aria-label="Notes" data-md-component="logo">
      
  <img src="../../img/brain.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SSH
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Notes" class="md-nav__button md-logo" aria-label="Notes" data-md-component="logo">
      
  <img src="../../img/brain.png" alt="logo">

    </a>
    Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Linux
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Concurrency/" class="md-nav__link">
        Concurrency
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Containers/" class="md-nav__link">
        Containers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Databases/" class="md-nav__link">
        Databases
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Display/" class="md-nav__link">
        Display
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Files/" class="md-nav__link">
        Files
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Filters/" class="md-nav__link">
        Filters
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../GRUB/" class="md-nav__link">
        GRUB2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../IAM/" class="md-nav__link">
        Users
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Kernel/" class="md-nav__link">
        Kernel
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Network/" class="md-nav__link">
        Network
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Package/" class="md-nav__link">
        Package management
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Process/" class="md-nav__link">
        Process management
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Random/" class="md-nav__link">
        Random
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Red-Hat/" class="md-nav__link">
        Red Hat
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Ricing/" class="md-nav__link">
        Tiling window managers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Security/" class="md-nav__link">
        Security
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Shell/" class="md-nav__link">
        Shells
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../SystemD/" class="md-nav__link">
        SystemD
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Virtualization/" class="md-nav__link">
        Virtualization
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_22" checked>
      
      
      
        <label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="0">
          Applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_22_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_22">
          <span class="md-nav__icon md-icon"></span>
          Applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bind/" class="md-nav__link">
        BIND
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ffmpeg/" class="md-nav__link">
        ffmpeg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gnome/" class="md-nav__link">
        GNOME
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pam/" class="md-nav__link">
        PAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rhythmbox/" class="md-nav__link">
        Rhythmbox
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../screen/" class="md-nav__link">
        screen
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../selinux/" class="md-nav__link">
        SELinux
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          SSH
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        SSH
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tasks" class="md-nav__link">
    Tasks
  </a>
  
    <nav class="md-nav" aria-label="Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-forwarding" class="md-nav__link">
    Port forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x-forwarding" class="md-nav__link">
    X forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fail2ban" class="md-nav__link">
    fail2ban
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-configuration" class="md-nav__link">
    Client configuration
  </a>
  
    <nav class="md-nav" aria-label="Client configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transient-servers" class="md-nav__link">
    Transient servers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canonical-hostname" class="md-nav__link">
    Canonical hostname
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-configuration" class="md-nav__link">
    Server configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commands" class="md-nav__link">
    Commands
  </a>
  
    <nav class="md-nav" aria-label="Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#endlessh" class="md-nav__link">
    endlessh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-add" class="md-nav__link">
    ssh-add
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-agent" class="md-nav__link">
    ssh-agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-copy-id" class="md-nav__link">
    ssh-copy-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-keygen" class="md-nav__link">
    ssh-keygen
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../syncthing/" class="md-nav__link">
        Syncthing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vim/" class="md-nav__link">
        Vim
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../youtube-dl/" class="md-nav__link">
        Youtube dl
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="ssh">SSH</h1>
<p>SSH is a secure protocol and the most common way of remotely administering Linux servers and other equipment.
SSH uses <strong>symmetrical encryption</strong>, which means a single key encrypts outbound messages to and inbound messages from the other participant.</p>
<p>The SSH session is established in two stages:</p>
<ol>
<li>Negotiate session key</li>
<li>Authenticate the user</li>
</ol>
<p>The symmetrical key used for the session, called the <strong>session key</strong>, is negotiated through the asymmetrical <a href="#diffie-hellman">Diffie-Hellman</a> key exchange protocol.
This algorithm combines private data with public data from the other participant to produce the identical, session key, and the encryption used for the rest of the connection is called <strong>binary packet protocol</strong>.</p>
<p>The simplest and least secure method of authentication is password-based.
Although the password is sent through the encryption, it is still considered vulnerable to brute-force attacks.</p>
<p>SSH <strong>key pairs</strong>, which are asymmetric, are recommended. These are what is generated by <a href="#ssh-keygen"><strong>ssh-keygen</strong></a>, and stored in <strong>$HOME/.ssh</strong> with names that reflect the encryption algorithm, i.e. "id_rsa" and "id_rsa.pub", etc.
The public key, used to <strong>encrypt</strong> data for the private key, can be freely shared.
In fact, this is the purpose of <strong>ssh-copy-id</strong>, to share the public key.
However the private key, which is used for decryption, must be kept secret.</p>
<p>The client sends an ID for the key pair it wants to authenticate with to the server. The server then checks the <strong>authorized_keys</strong> file of the requested account for the ID.
A random number is generated by the server, encrypted with the public key, and sent to the client.
The client then decrypts the random number and combines it with the shared session key and calculates the MD5 hash.
This hash is then sent back to the server, which checks the calculation.</p>
<p>Note that the SSH server is named <strong>openssh-server</strong> in Ubuntu repos and the service is named <strong>ssh</strong>, as opposed to <strong>sshd</strong> on Red Hat systems.</p>
<h2 id="tasks">Tasks</h2>
<h4 id="port-forwarding">Port forwarding</h4>
<dl>
<dd>
<p>Port forwarding is accomplished in one of two ways, local or remote with respect to the <strong>server</strong> not the client.</p>
<ul>
<li><strong>Local</strong> (<strong><code>-L</code></strong>): connections to the client are forwarded through the SSH tunnel to the SSH server. This technique is used to provide functionality similar to a VPN, where remote access is made possible to content on a private network, such as file shares or web applications that are not exposed publicly.</li>
<li><strong>Remote</strong> (<strong><code>-R</code></strong>)...</li>
<li><strong>Dynamic</strong></li>
</ul>
<p>Here, a private web application served locally on <strong>ssh-server</strong> will be served on the client at the same port.
The first "localhost" can actually be omitted, since the connection will be exposed on localhost host by default and is almost universally.</p>
<p>The confusing part is the second "localhost", because that is actually in reference to the ssh server itself.
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-L<span class="w"> </span>localhost:80:localhost:80<span class="w"> </span>ssh-server
</code></pre></div>
It is actually possible to forward a request to another host on ssh-server's network, creating a jump box.
Here a connection on the client's localhost:81 is forwarded to ssh-server, which then sends it to 192.168.1.1:80.
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-L<span class="w"> </span><span class="m">81</span>:192.168.1.1:80<span class="w"> </span>ssh-server
</code></pre></div></p>
</dd>
</dl>
<h4 id="x-forwarding">X forwarding</h4>
<dl>
<dd><div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-Y<span class="w"> </span>user@host
</code></pre></div>
Have remote system use local computer {me.luna.edu}'s X display
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DISPLAY</span><span class="o">=</span>me.luna.edu:0
</code></pre></div></dd>
</dl>
<h4 id="fail2ban">fail2ban</h4>
<dl>
<dd>
<p>&lt;!--
On the first ban, f2b creates a new chain named <strong>f2b-name</strong> where "name" is the name of the jail, as defined in the config.</p>
<div class="highlight"><span class="filename">/etc/fail2ban/action.d/iptables.conf</span><pre><span></span><code><span class="na">actionstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;iptables&gt; -N f2b-&lt;name&gt;</span>
</code></pre></div>
<p>This chain becomes the target of banned IPs, which are somehow added (although I don't know how).
--&gt;</p>
<p>Fail2ban is an intrusion prevention framework written in Python and that runs as a service.
It can be installed from most distributions' repos.</p>
<p>The <strong>jail</strong> is a key concept in f2b that couples <strong>filters</strong> and <strong>actions</strong> definitions.</p>
<p>Fail2ban is configured through .ini-format configs found in <strong>/etc/fail2ban</strong>.
It is recommended not to edit the default configs ending in .config but rather to create a custom config called <strong>jail.local</strong> which will be automatically loaded by the service.</p>
<div class="highlight"><span class="filename">Example jail</span><pre><span></span><code><span class="k">[sshd]</span>
<span class="na">enabled</span><span class="o">=</span><span class="s">true</span>
<span class="na">port</span><span class="o">=</span><span class="s">ssh</span>
<span class="na">filter</span><span class="o">=</span><span class="s">sshd</span>
<span class="na">logpath</span><span class="o">=</span><span class="s">/var/log/auth.log</span>
<span class="na">maxretry</span><span class="o">=</span><span class="s">0</span>
<span class="na">findtime</span><span class="o">=</span><span class="s">300</span>
<span class="na">bantime</span><span class="o">=</span><span class="s">3600</span>
</code></pre></div>
<p>Failed logins can be checked by running <strong>lastb</strong>, and connections are also logged to SystemD.
<div class="highlight"><pre><span></span><code>journalctl<span class="w"> </span>-ru<span class="w"> </span>sshd
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Display banned IPs</span>
fail2ban-client<span class="w"> </span>banned

<span class="c1"># Manually ban an IP</span>
fail2ban-client<span class="w"> </span><span class="nb">set</span><span class="w"> </span>sshd<span class="w"> </span>banip<span class="w"> </span><span class="nv">$IPADDRESS</span>

<span class="c1"># Manually unban an IP</span>
fail2ban-client<span class="w"> </span>unban<span class="w"> </span><span class="nv">$IPADDRESS</span>
</code></pre></div>
</dd>
</dl>
<h3 id="configuration">Configuration</h3>
<p>Server and client configuration both use the same set of <a href="https://man.openbsd.org/ssh_config">keywords</a> that can be defined inline on invocation or in config files.</p>
<h3 id="client-configuration">Client configuration</h3>
<dl>
<dd>
<div class="highlight"><pre><span></span><code>Host<span class="w"> </span>home
<span class="w">    </span>HostName<span class="w"> </span><span class="m">192</span>.168.1.1
<span class="w">    </span>User<span class="w"> </span>root
<span class="w">    </span>Port<span class="w"> </span><span class="m">50022</span>
<span class="w">    </span>SetEnv<span class="w"> </span><span class="nv">BAT_THEME</span><span class="o">=</span>OneHalfLight<span class="w"> </span><span class="c1"># (1)</span>
<span class="w">    </span>LocalForward<span class="w"> </span><span class="m">8080</span><span class="w"> </span>localhost:8080<span class="w"> </span><span class="c1"># (2)</span>
</code></pre></div>
<ol>
<li><a href="https://man.openbsd.org/ssh_config#SetEnv"><strong>SetEnv</strong></a> allows environment variables to be set in a remote session. 
However, these same environment variables must be explicitly specified in <a href="https://man.openbsd.org/sshd_config#AcceptEnv"><strong>AcceptEnv</strong></a> key of the <a href="#server-configuration">server configuration</a>.
This entry will set a specific syntax highlighting theme for use on the bat CLI utility.
<div class="highlight"><span class="filename">/etc/ssh/sshd_config</span><pre><span></span><code>AcceptEnv<span class="w"> </span>BAT_THEME
</code></pre></div></li>
<li>The use of <a href="https://man.openbsd.org/ssh_config#LocalForward"><strong>LocalForward</strong></a> here is equivalent to the use of the <strong>-L</strong> option at the command-line:
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-L<span class="w"> </span><span class="m">8080</span>:localhost:8080<span class="w"> </span><span class="nv">$SERVER</span>
</code></pre></div></li>
</ol>
</dd>
</dl>
<h4 id="transient-servers">Transient servers</h4>
<dl>
<dd>
<p>Prevent recording a transient server to the client's known hosts file.
This is useful when SSHing to many hosts from a single client, say while managing a corporate environment.</p>
<div class="highlight"><pre><span></span><code>UserKnownHostsFile<span class="w"> </span>/dev/null<span class="w"> </span><span class="c1"># (1)</span>
StrictHostKeyChecking<span class="w"> </span>no<span class="w"> </span><span class="c1"># (2)</span>
</code></pre></div>
<ol>
<li><a href="https://man.openbsd.org/ssh_config#UserKnownHostsFile"><strong>UserKnownHostsFile</strong></a></li>
<li><a href="https://man.openbsd.org/ssh_config#StrictHostKeyChecking"><strong>StrictHostKeyChecking</strong></a></li>
</ol>
</dd>
</dl>
<h4 id="canonical-hostname">Canonical hostname</h4>
<dl>
<dd>
<p>In <a href="https://serverfault.com/questions/363055/regular-expression-matching-in-ssh-config">corporate environments with verbose domain names</a>, <a href="https://man.openbsd.org/ssh_config#CanonicalDomains"><strong>canonical hostnames</strong></a> can be configured to automatically append repetitive domain names ("canonicalize") to destination hosts.</p>
<p>In this example, any connection made to a hostname beginning with "server" will append "example.com".</p>
<div class="highlight"><pre><span></span><code>Host<span class="w"> </span>server*
<span class="w">    </span>CanonicalDomains<span class="w"> </span>example.com<span class="w"> </span><span class="c1"># (1)</span>
<span class="w">    </span>CanonicalizeHostname<span class="w"> </span>always<span class="w"> </span><span class="c1"># (2)</span>
</code></pre></div>
<ol>
<li><a href="https://man.openbsd.org/ssh_config#CanonicalDomains"><strong>CanonicalDomains</strong></a></li>
<li><a href="https://man.openbsd.org/ssh_config#CanonicalizeHostname"><strong>CanonicalizeHostname</strong></a></li>
</ol>
</dd>
</dl>
<h3 id="server-configuration">Server configuration</h3>
<dl>
<dd><div class="highlight"><span class="filename">/etc/ssh/sshd_config</span><pre><span></span><code><span class="c1"># Disable cleartext passwords</span>
<span class="na">PasswordAuthentication no</span>

<span class="c1"># Disable root login</span>
<span class="na">PermitRootLogin no</span>
</code></pre></div></dd>
</dl>
<h2 id="commands">Commands</h2>
<h4 id="endlessh">endlessh</h4>
<dl>
<dd>
<div class="highlight"><span class="filename">Log verbosity</span><pre><span></span><code><span class="c1"># Silent</span>
endlessh

<span class="c1"># Normal</span>
endlessh<span class="w"> </span>-v

<span class="c1"># Debug</span>
endlessh<span class="w"> </span>-vv
</code></pre></div>
<div class="highlight"><span class="filename">Log verbosity</span><pre><span></span><code>LogLevel 0 # silent
LogLevel 1 # normal
LogLevel 2 # debug
</code></pre></div>
</dd>
</dl>
<h4 id="ssh-add">ssh-add</h4>
<dl>
<dd>
<div class="highlight"><pre><span></span><code><span class="nb">eval</span><span class="w"> </span><span class="k">$(</span>ssh-agent<span class="k">)</span><span class="p">;</span><span class="w"> </span>ssh-add<span class="w"> </span>&lt;<span class="o">(</span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>keyFile.secureFilePath<span class="k">)</span><span class="s2">&quot;</span><span class="o">)</span>
</code></pre></div>
<p><a href="https://www.ssh.com/academy/ssh/add-command">ssh-add</a> adds private key identities to the OpenSSH authentication agent, <a href="#ssh-agent">ssh-agent</a>.
Notably, ssh-add requires the <strong>SSH_AUTH_SOCK</strong> environment variable set by ssh-agent.</p>
<p>When run without arguments, it adds the private keys found in <strong>~/.ssh</strong>, i.e.</p>
<ul>
<li>id_rsa</li>
<li>id_dsa</li>
<li>id_ecdsa</li>
<li>id_ecdsa_sk</li>
<li>id_ed25519</li>
<li>id_ed25519_sk</li>
</ul>
</dd>
</dl>
<h4 id="ssh-agent">ssh-agent</h4>
<dl>
<dd>
<div class="highlight"><pre><span></span><code><span class="nb">eval</span><span class="w"> </span><span class="k">$(</span>ssh-agent<span class="k">)</span><span class="p">;</span><span class="w"> </span>ssh-add<span class="w"> </span>&lt;<span class="o">(</span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>keyFile.secureFilePath<span class="k">)</span><span class="s2">&quot;</span><span class="o">)</span>
</code></pre></div>
<p>ssh-agent is a <a href="https://www.ssh.com/academy/ssh/agent">helper program</a> that keeps track of identity keys and passphrases, allowing them to be used without further interaction, similar to SSO.
Running it produces output that is meant to be used with the <strong>eval</strong> command in order to set the environment variables <strong>SSH_AGENT_PID</strong> and <strong>SSH_AUTH_SOCK</strong>, which are needed by <a href="#ssh-add">ssh-add</a>.</p>
<p>If only a single process is running, the <strong>-k</strong> option will kill it (although it is possible to fork multiple ssh-agent processes).
<div class="highlight"><pre><span></span><code>ssh-agent<span class="w"> </span>-k<span class="w"> </span><span class="c1"># (1)</span>
</code></pre></div></p>
<ol>
<li>Equivalent to
<div class="highlight"><pre><span></span><code><span class="nb">kill</span><span class="w"> </span><span class="nv">$SSH_AGENT_PID</span>
</code></pre></div></li>
</ol>
</dd>
</dl>
<h4 id="ssh-copy-id">ssh-copy-id</h4>
<dl>
<dd>
<p>This command copies the SSH public key to a specified account's <strong>~/.ssh/authorized_keys</strong> file.</p>
<p>In Windows, this command is not available, so a workaround is to simply <a href="https://www.chrisjhart.com/Windows-10-ssh-copy-id/">pipe the public key</a> over SSH itself.</p>
<div class="highlight"><pre><span></span><code><span class="nb">type</span><span class="w"> </span><span class="nv">$env</span>:USERPROFILE<span class="se">\.</span>ssh<span class="se">\i</span>d_rsa.pub<span class="w"> </span><span class="p">|</span><span class="w"> </span>ssh<span class="w"> </span><span class="o">{</span>IP-ADDRESS-OR-FQDN<span class="o">}</span><span class="w"> </span><span class="s2">&quot;cat &gt;&gt; .ssh/authorized_keys&quot;</span>
</code></pre></div>
</dd>
</dl>
<h4 id="ssh-keygen">ssh-keygen</h4>
<dl>
<dd><div class="highlight"><span class="filename">Generate host keys</span><pre><span></span><code>sudo<span class="w"> </span>ssh-keygen<span class="w"> </span>-A
</code></pre></div></dd>
</dl>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.expand", "toc.integrate", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b425cdc4.min.js"></script>
      
    
  </body>
</html>